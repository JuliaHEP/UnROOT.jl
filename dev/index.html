<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Introduction · UnROOT.jl</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>UnROOT.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Introduction</a><ul class="internal"><li><a class="tocitem" href="#Status"><span>Status</span></a></li><li><a class="tocitem" href="#Quick-Start"><span>Quick Start</span></a></li><li><a class="tocitem" href="#Branch-of-custom-struct"><span>Branch of custom struct</span></a></li><li><a class="tocitem" href="#Main-challenges"><span>Main challenges</span></a></li><li><a class="tocitem" href="#Low-hanging-fruits"><span>Low hanging fruits</span></a></li><li><a class="tocitem" href="#Acknowledgements"><span>Acknowledgements</span></a></li><li><a class="tocitem" href="#Behind-the-scene"><span>Behind the scene</span></a></li><li><a class="tocitem" href="#Contributors"><span>Contributors ✨</span></a></li></ul></li><li><a class="tocitem" href="quickstart/">Quick Start</a></li><li><a class="tocitem" href="internals/">Internals</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Introduction</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Introduction</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/tamasgal/UnROOT.jl/blob/master/README.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><p>&lt;img style=&quot;height:5em;&quot; alt=&quot;UnROOT.jl&quot; src=&quot;docs/src/assets/unroot.svg&quot;/&gt;</p><p>&lt;!– ALL-CONTRIBUTORS-BADGE:START - Do not remove or modify this section –&gt; <a href="#contributors-"><img src="https://img.shields.io/badge/all_contributors-5-orange.svg?style=flat-square" alt="All Contributors"/></a> &lt;!– ALL-CONTRIBUTORS-BADGE:END –&gt; <a href="https://tamasgal.github.io/UnROOT.jl/dev"><img src="https://img.shields.io/badge/docs-dev-blue.svg" alt="Dev"/></a> <a href="https://github.com/tamasgal/UnROOT.jl/actions"><img src="https://github.com/tamasgal/UnROOT.jl/workflows/CI/badge.svg" alt="Build Status"/></a> <a href="https://codecov.io/gh/tamasgal/UnROOT.jl"><img src="https://codecov.io/gh/tamasgal/UnROOT.jl/branch/master/graph/badge.svg" alt="Codecov"/></a></p><p>UnROOT.jl is a (WIP) reader for the <a href="https://root.cern">CERN ROOT</a> file format written entirely in pure Julia, without any dependence on ROOT or Python.</p><p>While the ROOT documentation does not contain a detailed description of the binary structure, the format can be triangulated by other packages like</p><ul><li><a href="https://github.com/scikit-hep/uproot">uproot3</a> (Python), see also <a href="https://github.com/JuliaHEP/UpROOT.jl/">UpROOT.jl</a></li><li><a href="https://godoc.org/go-hep.org/x/hep/groot#hdr-File_layout">groot</a> (Go)</li><li><a href="https://github.com/cbourjau/alice-rs/tree/master/root-io">root-io</a> (Rust)</li><li><a href="https://github.com/spark-root/laurelin">Laurelin</a> (Java)</li></ul><p>Here&#39;s a detailed <a href="https://jiling.web.cern.ch/jiling/dump/ROOT_Fileformat.pdf">from-scratch walk through</a>  on reading a jagged branch from a ROOT file, recommended for first time contributors or those who just want to learn about ROOT file format.</p><p>Three&#39;s also a <a href="https://github.com/scikit-hep/uproot/issues/401">discussion</a> reagarding the ROOT binary format documentation on uproot&#39;s issue page.</p><h2 id="Status"><a class="docs-heading-anchor" href="#Status">Status</a><a id="Status-1"></a><a class="docs-heading-anchor-permalink" href="#Status" title="Permalink"></a></h2><p>We support reading all scalar and jagged branches of &quot;basic&quot; types, provide indexing and iteration interface with a &quot;per branch&quot; basket-cache. There is a low level API to provide interpretation functionalities for custom types and classes. As a metric, UnROOT can read all branches (~1800) of CMS NanoAOD including jagged <code>TLorentzVector</code> branch.</p><h2 id="Quick-Start"><a class="docs-heading-anchor" href="#Quick-Start">Quick Start</a><a id="Quick-Start-1"></a><a class="docs-heading-anchor-permalink" href="#Quick-Start" title="Permalink"></a></h2><p>The easiest way to access data is through <code>LazyTree</code>, which is <code>&lt;: AbstractDataFrame</code> and a thin-wrap around <code>TypedTable</code> under the hood. It supports most accessing patterns from the loved <code>DataFrames</code> eco-system.</p><pre><code class="language-julia hljs">julia&gt; using UnROOT

julia&gt; f = ROOTFile(&quot;test/samples/NanoAODv5_sample.root&quot;)
ROOTFile with 2 entries and 21 streamers.
test/samples/NanoAODv5_sample.root
└─ Events
   ├─ &quot;run&quot;
   ├─ &quot;luminosityBlock&quot;
   ├─ &quot;event&quot;
   ├─ &quot;HTXS_Higgs_pt&quot;
   ├─ &quot;HTXS_Higgs_y&quot;
   └─ &quot;⋮&quot;

julia&gt; mytree = LazyTree(f, &quot;Events&quot;, [&quot;Electron_dxy&quot;, &quot;nMuon&quot;, r&quot;Muon_(pt|eta)$&quot;])
 Row │ Electron_dxy     nMuon   Muon_eta         Muon_pt
     │ Vector{Float32}  UInt32  Vector{Float32}  Vector{Float32}
─────┼───────────────────────────────────────────────────────────
 1   │ [0.000371]       0       []               []
 2   │ [-0.00982]       2       [0.53, 0.229]    [19.9, 15.3]
 3   │ []               0       []               []
 4   │ [-0.00157]       0       []               []
 ⋮   │     ⋮            ⋮             ⋮                ⋮
 
 
julia&gt; mytree[1:3, :nMuon]
3-element Vector{UInt32}:
 0x00000000
 0x00000002
 0x00000000</code></pre><p>You can iterate through a <code>LazyTree</code>:</p><pre><code class="language-julia hljs">julia&gt; for event in mytree
           @show event.Electron_dxy
           break
       end
event.Electron_dxy = Float32[0.00037050247]</code></pre><p>Only one basket per branch will be cached so you don&#39;t have to worry about running out of RAM. At the same time, <code>event</code> inside the for-loop is not materialized until a field is accessed. If your event is fairly small or you need all of them anyway, you can <code>collect(event)</code> first inside the loop.</p><h2 id="Branch-of-custom-struct"><a class="docs-heading-anchor" href="#Branch-of-custom-struct">Branch of custom struct</a><a id="Branch-of-custom-struct-1"></a><a class="docs-heading-anchor-permalink" href="#Branch-of-custom-struct" title="Permalink"></a></h2><p>We provide an experimental interface for hooking up UnROOT with your custom types that only takes 2 steps, as explained <a href="https://github.com/tamasgal/UnROOT.jl/wiki/CustomBranch">here</a>. As a show case for this functionality, the <code>TLorentzVector</code> support in UnROOT is implemented with the said plug-in system.</p><p>Alternatively, reading raw data is also possible using the <code>UnROOT.array(f::ROOTFile, path; raw=true)</code> method. The output can be then reinterpreted using a custom type with the method <code>UnROOT.splitup(data, offsets, T::Type; skipbytes=0, jagged=true)</code>. This provides more fine grain control in case your branch is highly irregular. You can then define suitable Julia <code>type</code> and <code>readtype</code> method for parsing these data. Alternatively, you can of course parse the <code>data</code> and <code>offsets</code> entirely manually. Here is it in action, with the help of the <code>type</code>s from <code>custom.jl</code>, and some data from the KM3NeT experiment:</p><pre><code class="language-julia hljs">julia&gt; using UnROOT

julia&gt; f = ROOTFile(&quot;test/samples/km3net_online.root&quot;)
ROOTFile(&quot;test/samples/km3net_online.root&quot;) with 10 entries and 41 streamers.

julia&gt; data, offsets = array(f, &quot;KM3NET_EVENT/KM3NET_EVENT/snapshotHits&quot;; raw=true)
2058-element Array{UInt8,1}:
 0x00
 0x03
   ⋮
   
julia&gt; UnROOT.splitup(data, offsets, UnROOT.KM3NETDAQHit)
4-element Vector{Vector{UnROOT.KM3NETDAQHit}}:
 [UnROOT.KM3NETDAQHit(1073742790, 0x00, 9, 0x60)......</code></pre><h2 id="Main-challenges"><a class="docs-heading-anchor" href="#Main-challenges">Main challenges</a><a id="Main-challenges-1"></a><a class="docs-heading-anchor-permalink" href="#Main-challenges" title="Permalink"></a></h2><ul><li>ROOT data is generally stored as big endian and is a self-descriptive format, i.e. so-called streamers are stored in the files which describe the actual structure of the data in the corresponding branches. These streamers are read during runtime and need to be used to generate Julia structs and <code>unpack</code> methods on the fly.</li><li>Performance is very important for a low level I/O library.</li></ul><h2 id="Low-hanging-fruits"><a class="docs-heading-anchor" href="#Low-hanging-fruits">Low hanging fruits</a><a id="Low-hanging-fruits-1"></a><a class="docs-heading-anchor-permalink" href="#Low-hanging-fruits" title="Permalink"></a></h2><p>Pick one ;)</p><ul><li>[x] Parsing the file header</li><li>[x] Read the <code>TKey</code>s of the top level dictionary</li><li>[x] Reading the available trees</li><li>[x] Reading the available streamers</li><li>[x] Reading a simple dataset with primitive streamers</li><li>[x] Reading of raw basket bytes for debugging</li><li>[ ] Automatically generate streamer logic</li><li>[x] Prettier <code>show</code> for <code>Lazy*</code>s</li><li>[ ] Clean up <code>Cursor</code> use</li><li>[x] Reading <code>TNtuple</code> #27</li><li>[x] Reading histograms (<code>TH1D</code>, <code>TH1F</code>, <code>TH2D</code>, <code>TH2F</code>, etc.) #48</li><li>[ ] Clean up the <code>readtype</code>, <code>unpack</code>, <code>stream!</code> and <code>readobjany</code> construct</li><li>[ ] Refactor the code and add more docs</li><li>[ ] Class name detection of sub-branches</li><li>[ ] High-level histogram interface</li></ul><h2 id="Acknowledgements"><a class="docs-heading-anchor" href="#Acknowledgements">Acknowledgements</a><a id="Acknowledgements-1"></a><a class="docs-heading-anchor-permalink" href="#Acknowledgements" title="Permalink"></a></h2><p>Special thanks to Jim Pivarski (<a href="https://github.com/jpivarski">@jpivarski</a>) from the <a href="https://github.com/scikit-hep">Scikit-HEP</a> project, who is the main author of <a href="https://github.com/scikit-hep/uproot">uproot</a>, a native Python library to read and write ROOT files, which was and is a great source of inspiration and information for reverse engineering the ROOT binary structures.</p><h2 id="Behind-the-scene"><a class="docs-heading-anchor" href="#Behind-the-scene">Behind the scene</a><a id="Behind-the-scene-1"></a><a class="docs-heading-anchor-permalink" href="#Behind-the-scene" title="Permalink"></a></h2><p>&lt;details&gt;&lt;summary&gt;Some additional debug output: &lt;/summary&gt; &lt;p&gt;</p><pre><code class="language-julia hljs">julia&gt; using UnROOT

julia&gt; f = ROOTFile(&quot;test/samples/tree_with_histos.root&quot;)
Compressed stream at 1509
ROOTFile(&quot;test/samples/tree_with_histos.root&quot;) with 1 entry and 4 streamers.

julia&gt; keys(f)
1-element Array{String,1}:
 &quot;t1&quot;

julia&gt; keys(f[&quot;t1&quot;])
Compressed datastream of 1317 bytes at 1509 (TKey &#39;t1&#39; (TTree))
2-element Array{String,1}:
 &quot;mynum&quot;
 &quot;myval&quot;

julia&gt; f[&quot;t1&quot;][&quot;mynum&quot;]
Compressed datastream of 1317 bytes at 6180 (TKey &#39;t1&#39; (TTree))
UnROOT.TBranch
  cursor: UnROOT.Cursor
  fName: String &quot;mynum&quot;
  fTitle: String &quot;mynum/I&quot;
  fFillColor: Int16 0
  fFillStyle: Int16 1001
  fCompress: Int32 101
  fBasketSize: Int32 32000
  fEntryOffsetLen: Int32 0
  fWriteBasket: Int32 1
  fEntryNumber: Int64 25
  fIOFeatures: UnROOT.ROOT_3a3a_TIOFeatures
  fOffset: Int32 0
  fMaxBaskets: UInt32 0x0000000a
  fSplitLevel: Int32 0
  fEntries: Int64 25
  fFirstEntry: Int64 0
  fTotBytes: Int64 170
  fZipBytes: Int64 116
  fBranches: UnROOT.TObjArray
  fLeaves: UnROOT.TObjArray
  fBaskets: UnROOT.TObjArray
  fBasketBytes: Array{Int32}((10,)) Int32[116, 0, 0, 0, 0, 0, 0, 0, 0, 0]
  fBasketEntry: Array{Int64}((10,)) [0, 25, 0, 0, 0, 0, 0, 0, 0, 0]
  fBasketSeek: Array{Int64}((10,)) [238, 0, 0, 0, 0, 0, 0, 0, 0, 0]
  fFileName: String &quot;&quot;


julia&gt; seek(f.fobj, 238)
IOStream(&lt;file test/samples/tree_with_histos.root&gt;)

julia&gt; basketkey = UnROOT.unpack(f.fobj, UnROOT.TKey)
UnROOT.TKey64(116, 1004, 100, 0x6526eafb, 70, 0, 238, 100, &quot;TBasket&quot;, &quot;mynum&quot;, &quot;t1&quot;)

julia&gt; s = UnROOT.datastream(f.fobj, basketkey)
Compressed datastream of 100 bytes at 289 (TKey &#39;mynum&#39; (TBasket))
IOBuffer(data=UInt8[...], readable=true, writable=false, seekable=true, append=false, size=100, maxsize=Inf, ptr=1, mark=-1)

julia&gt; [UnROOT.readtype(s, Int32) for _ in 1:f[&quot;t1&quot;][&quot;mynum&quot;].fEntries]
Compressed datastream of 1317 bytes at 6180 (TKey &#39;t1&#39; (TTree))
25-element Array{Int32,1}:
  0
  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 10
 10
 10
 10</code></pre><p>&lt;/p&gt; &lt;/details&gt;</p><h2 id="Contributors"><a class="docs-heading-anchor" href="#Contributors">Contributors ✨</a><a id="Contributors-1"></a><a class="docs-heading-anchor-permalink" href="#Contributors" title="Permalink"></a></h2><p>Thanks goes to these wonderful people (<a href="https://allcontributors.org/docs/en/emoji-key">emoji key</a>):</p><p>&lt;!– ALL-CONTRIBUTORS-LIST:START - Do not remove or modify this section –&gt; &lt;!– prettier-ignore-start –&gt; &lt;!– markdownlint-disable –&gt; &lt;table&gt;   &lt;tr&gt;     &lt;td align=&quot;center&quot;&gt;&lt;a href=&quot;http://www.tamasgal.com&quot;&gt;&lt;img src=&quot;https://avatars.githubusercontent.com/u/1730350?v=4?s=100&quot; width=&quot;100px;&quot; alt=&quot;&quot;/&gt;&lt;br /&gt;&lt;sub&gt;&lt;b&gt;Tamas Gal&lt;/b&gt;&lt;/sub&gt;&lt;/a&gt;&lt;br /&gt;&lt;a href=&quot;https://github.com/tamasgal/UnROOT.jl/commits?author=tamasgal&quot; title=&quot;Code&quot;&gt;💻&lt;/a&gt; &lt;a href=&quot;https://github.com/tamasgal/UnROOT.jl/commits?author=tamasgal&quot; title=&quot;Documentation&quot;&gt;📖&lt;/a&gt; &lt;a href=&quot;#infra-tamasgal&quot; title=&quot;Infrastructure (Hosting, Build-Tools, etc)&quot;&gt;🚇&lt;/a&gt; &lt;a href=&quot;#data-tamasgal&quot; title=&quot;Data&quot;&gt;🔣&lt;/a&gt; &lt;a href=&quot;https://github.com/tamasgal/UnROOT.jl/commits?author=tamasgal&quot; title=&quot;Tests&quot;&gt;⚠️&lt;/a&gt;&lt;/td&gt;     &lt;td align=&quot;center&quot;&gt;&lt;a href=&quot;https://github.com/Moelf&quot;&gt;&lt;img src=&quot;https://avatars.githubusercontent.com/u/5306213?v=4?s=100&quot; width=&quot;100px;&quot; alt=&quot;&quot;/&gt;&lt;br /&gt;&lt;sub&gt;&lt;b&gt;Jerry Ling&lt;/b&gt;&lt;/sub&gt;&lt;/a&gt;&lt;br /&gt;&lt;a href=&quot;https://github.com/tamasgal/UnROOT.jl/commits?author=Moelf&quot; title=&quot;Code&quot;&gt;💻&lt;/a&gt; &lt;a href=&quot;https://github.com/tamasgal/UnROOT.jl/commits?author=Moelf&quot; title=&quot;Tests&quot;&gt;⚠️&lt;/a&gt; &lt;a href=&quot;#data-Moelf&quot; title=&quot;Data&quot;&gt;🔣&lt;/a&gt; &lt;a href=&quot;https://github.com/tamasgal/UnROOT.jl/commits?author=Moelf&quot; title=&quot;Documentation&quot;&gt;📖&lt;/a&gt;&lt;/td&gt;     &lt;td align=&quot;center&quot;&gt;&lt;a href=&quot;https://github.com/8me&quot;&gt;&lt;img src=&quot;https://avatars.githubusercontent.com/u/17862090?v=4?s=100&quot; width=&quot;100px;&quot; alt=&quot;&quot;/&gt;&lt;br /&gt;&lt;sub&gt;&lt;b&gt;Johannes Schumann&lt;/b&gt;&lt;/sub&gt;&lt;/a&gt;&lt;br /&gt;&lt;a href=&quot;https://github.com/tamasgal/UnROOT.jl/commits?author=8me&quot; title=&quot;Code&quot;&gt;💻&lt;/a&gt; &lt;a href=&quot;https://github.com/tamasgal/UnROOT.jl/commits?author=8me&quot; title=&quot;Tests&quot;&gt;⚠️&lt;/a&gt; &lt;a href=&quot;#data-8me&quot; title=&quot;Data&quot;&gt;🔣&lt;/a&gt;&lt;/td&gt;     &lt;td align=&quot;center&quot;&gt;&lt;a href=&quot;https://github.com/aminnj&quot;&gt;&lt;img src=&quot;https://avatars.githubusercontent.com/u/5760027?v=4?s=100&quot; width=&quot;100px;&quot; alt=&quot;&quot;/&gt;&lt;br /&gt;&lt;sub&gt;&lt;b&gt;Nick Amin&lt;/b&gt;&lt;/sub&gt;&lt;/a&gt;&lt;br /&gt;&lt;a href=&quot;https://github.com/tamasgal/UnROOT.jl/commits?author=aminnj&quot; title=&quot;Code&quot;&gt;💻&lt;/a&gt; &lt;a href=&quot;https://github.com/tamasgal/UnROOT.jl/commits?author=aminnj&quot; title=&quot;Tests&quot;&gt;⚠️&lt;/a&gt; &lt;a href=&quot;#data-aminnj&quot; title=&quot;Data&quot;&gt;🔣&lt;/a&gt;&lt;/td&gt;     &lt;td align=&quot;center&quot;&gt;&lt;a href=&quot;https://giordano.github.io&quot;&gt;&lt;img src=&quot;https://avatars.githubusercontent.com/u/765740?v=4?s=100&quot; width=&quot;100px;&quot; alt=&quot;&quot;/&gt;&lt;br /&gt;&lt;sub&gt;&lt;b&gt;Mosè Giordano&lt;/b&gt;&lt;/sub&gt;&lt;/a&gt;&lt;br /&gt;&lt;a href=&quot;#infra-giordano&quot; title=&quot;Infrastructure (Hosting, Build-Tools, etc)&quot;&gt;🚇&lt;/a&gt;&lt;/td&gt;   &lt;/tr&gt; &lt;/table&gt;</p><p>&lt;!– markdownlint-restore –&gt; &lt;!– prettier-ignore-end –&gt;</p><p>&lt;!– ALL-CONTRIBUTORS-LIST:END –&gt;</p><p>This project follows the <a href="https://github.com/all-contributors/all-contributors">all-contributors</a> specification. Contributions of any kind welcome!</p></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="quickstart/">Quick Start »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.4 on <span class="colophon-date" title="Thursday 22 July 2021 07:48">Thursday 22 July 2021</span>. Using Julia version 1.6.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
